<div idGrupo="{{ idGrupo }}" id="pantallaMensajes" class="container bg-light text-dark shadow"
    style="font-family: 'Righteous', sans-serif; min-height:90vh; padding-bottom: 100px;overflow-wrap:break-word ">

    <span id="mensajes"></span>

</div>

<div id="barraChat" class='fixed-bottom bg-primary p-3' style="height:0px">
    <div class='row align-items-center'>
        <div class='col-md-1'></div>
        <div class='col-md-9'>
            <textarea id="mensajeEnviar" type="textarea" spellcheck="true" class="form-control w-100 py-auto mb-1"
                id="mensaje" placeholder="Mensaje" rows="1"
                style="font-family: 'Righteous', sans-serif; font-size: 25px;"></textarea>
        </div>
        <div class='col-md-1 text-center'>
            <button id="botonEnviar" class="btn btn-primary">
                <h6 class="m-2"><i class="fa fa-envelope" aria-hidden="true"></i> Enviar</h6>
            </button>
        </div>
        <div class='col-md-1'></div>
    </div>
</div>


<script>
    chat.idUltimoMensaje=0;///////////// Se modificará con la fecha de suscripción
    var alturaPantalla = window.screen.width;
    if (alturaPantalla < 768) {
        $("#barraChat").animate({
            height: '120px'
        });
    } else {
        $("#barraChat").animate({
            height: '100px'
        });
    }
    $("#botonEnviar").on("click", function () {
        
        $("#botonEnviar").off();
        $("#barraChat").animate({
            height: '0px'
        });

        $("#pantallaMensajes").html("<h1>Mensaje enviado...</h1>");

        $.ajax({
            url: '/principal/escribirMensaje/'+ $("#pantallaMensajes").attr('idGrupo') + "/" + $("#mensajeEnviar").val(),
            success: function (data) {
                $("#mensajeEnviar").val("");
                console.log("Mensaje guardado en la base de datos");
            }
        });
    });
    
    /*
    function cargarPantallaChat() {
        $("#contenedorPantallas").fadeOut(200, function () {
            $.ajax({
                url: '/grupos/ajaxObtenerConversacion/' + idGrupo,
                success: function (data) {
                    refrescando=false;
                    $("#contenedorPantallas").html(data).fadeIn(500);
                }
            });
        })
    }

    var idUltimoMensaje=0;
    hilos++;
    timer = setTimeout("temporizador()", 3000); ///Se refresca cada 5s
    function temporizador() {
        console.log("Refrescado grupo " + $("#pantallaMensajes").attr('idGrupo') + " hilos " + hilos);       
        $.ajax({
            type: "POST",
            url: '/grupos/ajaxRefrescarPantallaConversacion/' + $("#pantallaMensajes").attr('idGrupo') + '/' + idUltimoMensaje,
            success: function (data) {
                if(hilos==1){
                    if($("#pantallaMensajes").attr('idGrupo')==data['idGrupoRecibido']){
                        $.each(data['texto'], function(key, value){
                            var plantilla =$('#planMensaje').html();
                            plantilla =chat.reemplazar(plantilla ,'##IDUS##', value['id']);
                            plantilla =chat.reemplazar(plantilla ,'##NOMBRE##', value['nombre']);
                            plantilla =chat.reemplazar(plantilla ,'##FECHA##', value['fecha']);
                            plantilla =chat.reemplazar(plantilla ,'##MENSAJE##', value['mensaje']);
                            $("#mensajes").prepend(plantilla);
                            idUltimoMensaje=value['id'];
                        });
                    }
                    timer = setTimeout("temporizador()", 3000);
                }else{
                    hilos--;
                }
            }
        });
    }
    */
</script>